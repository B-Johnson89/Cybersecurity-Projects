# Objective: Exploit a Linux machine & escalate privileges on a Linux machine to gain root access.

In the first step in my Kali VM, I ran (ifconfig) to get the machine's IP address (10.0.2.6). Next, I ran a scan using the command (nmap 10.0.2.0/25) and noted the IP (10.0.2.15) and the ports, especially port 80, open on it.

Next, I navigated to the IP address (10.0.2.15) of the Metasplotiable VM in Firefox and moved into the Drupal directory.

After that I started MSFconsole and searched for (drupal exploits) I chose exploit number 2 based on the HTTP parameter key as that is also the service running on port 80.

After selecting 2 with the command (use 2), I used the command “show options” to see the module options and what would have to be adjusted. I see that RHOSTS (Target IP), RPORT (80), & TARGETURI (URL from Firefox).

After running that, a Meterpreter session was opened. After running the command (getuid) I received the username of (www-data).

Next, I went to the LinPEAS GitHub page and copied the command to start it on the VM. After copying that into the terminal, LinPeas started. I then took note of the overlayfs CVE ([CVE-2016-1328] overlayfs).

Back in the meterpreter, I searched for overlayfs modules. I chose number 1 because the disclosure date is the same year as the CVE.

After the command (use 1), I set the LHOST (Host IP) options and set the session to number 1.

After running the exploit, a session was not created due to the PHP session architecture.

I went back to the root directory and found payroll_app.php. I tried some SQL Injection in the username field and entered “’ OR 1=1#”. I was then shown a list of usernames, first and last names, and salaries.

I went back to the login page and entered the following in the username field (' OR 1=1 UNION SELECT null,null,username,password FROM users#) and was again shown another list of Usernames, first names, last names, and salaries, along with the usernames and passwords.

From that list, I'm choosing to log in as jarjar_binks. In the previous nmap scan, port 22 was open and running SSH. I started the SSH with the command (ssh jarjar_binks@10.0.2.15) which is the username and the IP address of the target VM. I was then prompted to enter the password, and I did, then logged in as jarjar-binks.  

While there, I changed directories to the (etc) directory and the cat shadow file, and the permission was denied. 

Next, I must create an MSFvenom payload to privilege escalate from the shell. I use the command (msfvenom -l payloads | grep linux). I found the payload I wanted to craft (linux/x86/shell/reverse_tcp).

Next, I crafted the payload and set the LHOST and LPORT. I also saved it as an elf file with the name shells.

From there, I must transfer the file to the target machine via scp. This was done with the command (scp shells.elf jarjar_binks@10.0.2.15:/home/jarjar_binks). I confirmed the transfer with command ls, and it was there.

Next, I returned to the MSF console to search for a multi-handler and used the number 5 as a generic payload handler.

I then set the options for the payload (linux/x86/shell/reverse_tcp), LHOST, & LPORT.

Next, I ran the multi-handler with the command “run”. Then, I moved to the SSH and ran the command (./shells.elf). MSFconsole shell session 2 was opened, and I was logged in as jarjar_binks confirmed by the (whoami) command.

Then I moved back to MSFconsole and searched for overlayfs again and used 1 again and then set the session to number 2. Then I ran it, and session 3 opened, and I am in as root, confirmed by the (whoami) command.

I CD into the etc directory and cat the shadow file, and I now have access.

